<!DOCTYPE html>
<html>
<head>
  <title>Stream Display</title>
  <style>
    .video-container {
      max-width: 854px;
      position: relative;
    }
  </style>
  <script>
    // Function to format the available date and time
    function formatDateTime(date) {
      const options = {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false,
      };
      return date.toLocaleString('en-GB', options);
    }

    // Function to create the formatted output as a link with thumbnail
    function formatOutput(item) {
      const localDateFormat = formatDateTime(new Date(item.available_at));
      const title = item.title;
      const englishName = item.englishName;
      const status = item.status.toUpperCase();
      let formattedData = '';

      formattedData += `<code>[${localDateFormat}] ${title} / ${englishName} (${status})</code><br>`;
      formattedData += `<div class="video-container">`;
      formattedData += `<a href="https://www.youtube.com/watch?v=${item.id}" target="_blank" style="display: block; position: relative;">`;
      formattedData += `<img style="max-width: 100%; height: auto; width: 100%;" src="https://img.youtube.com/vi/${item.id}/maxresdefault.jpg" alt="${title}">`;
      formattedData += `</a></div><br><br>`;
      return formattedData;
    }

    // Function to process and format API response data
    function processApiResponse(data) {
      let formattedData = '';
      data.forEach(item => {
        formattedData += formatOutput(item);
      });
      document.getElementById('api-response').innerHTML = formattedData;
    }

    // Function to populate the topic select dropdown (assuming you have a `topics` array)
    function populateTopics() {
      const topicSelect = document.getElementById('topic');
      topics.forEach(function(topic, index) {
        const option = document.createElement('option');
        option.value = topic.value;
        option.textContent = topic.label;
        if (index === 0) {
          option.selected = true; // Set the first option as selected
        }
        topicSelect.appendChild(option);
      });
    }

    // Call the API when the page loads (assuming your `callApi` function retrieves data)
    populateTopics();  // Call populateTopics before calling the API
    callApi().then(processApiResponse);

    // Function to handle topic change (assuming you have a `changeTopic` function)
    function changeTopic() {
      callApi();  // Call API again when the topic changes
    }
  </script>
</head>

<body>
  <div id="input">
    <label for="topic">Topic:</label>
    <select id="topic" onchange="changeTopic()">
    </select>
    <input type="radio" id="output-link" name="output-choice" value="link" checked>
    <label for="output-link">Link</label>
    <label for="api-key"><a href="https://holodex.net/" target="_blank">Holodex</a> API Key:
    </label>
    <input type="text" id="api-key">
    <button onclick="performApiRequest(document.getElementById('api-key').value)">Submit</button>
  </div>
  <div id="api-response"></div>
</body>
</html>
